<div class="container mt-4">
  <mat-card>
    <mat-card-header class="flex-column">
      @if(successMsg()){
      <div class="alert alert-success my-3">
        {{successMsg()}}
      </div>
      }

      @if(errorMsg()){
        <div class="alert alert-danger">
          {{errorMsg()}}
        </div>
      }

      <mat-card-title class="my-2">Créer un nouvel article</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="postForm" (ngSubmit)="onSubmit()">
        <mat-form-field appearance="outline" class="w-100 mb-3">
          <mat-label>Titre</mat-label>
          <input matInput formControlName="title" required>
          <mat-error *ngIf="postForm.get('title')?.invalid && postForm.get('title')?.touched">
            Le titre est requis.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-100 mb-3">
          <mat-label>Slug (URL conviviale)</mat-label>
          <input matInput formControlName="slug" required>
          <mat-error *ngIf="postForm.get('slug')?.invalid && postForm.get('slug')?.touched">
            Le slug est requis.
          </mat-error>
        </mat-form-field>

        <!-- Intégration de CKEditor via ton composant app-editor -->
        <app-editor formControlName="content" label="Contenu de l'article"></app-editor>
        <div *ngIf="postForm.get('content')?.invalid && postForm.get('content')?.touched" class="alert alert-danger">
          Le contenu est requis.
        </div>

        <!-- Tags input with Autocomplete -->
        <mat-form-field appearance="outline" class="w-100 my-3">
          <mat-label>Tags</mat-label>
          <mat-chip-grid #chipGrid aria-label="Tags de l'article">
            <mat-chip-row *ngFor="let tag of selectedTags" (removed)="removeTag(tag)">
              {{ tag }}
              <button matChipRemove [attr.aria-label]="'remove ' + tag">
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip-row>
          </mat-chip-grid>
          <input placeholder="Ajouter un tag..." #tagInput [formControl]="tagCtrl" [matChipInputFor]="chipGrid"
            [matAutocomplete]="auto" (matChipInputTokenEnd)="addTagFromInput($event)">
          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
            <mat-option *ngFor="let tag of filteredTags | async" [value]="tag">
              {{ tag }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>


        <button mat-raised-button color="primary" type="submit" [disabled]="postForm.invalid" class="me-2">
          {{ isEditMode ? 'Mettre à jour' : 'Créer' }}
        </button>
        <button mat-raised-button color="warn" type="button" (click)="onCancel()">Annuler</button>
      </form>
    </mat-card-content>
  </mat-card>
</div>